<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V.S.A. Corp. - Boot Sequence</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* =========================================================================
           SEÇÃO CSS: RESET e ESTILOS BASE (MUDANÇA: Começa em verde)
           ========================================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Press Start 2P', monospace;
            background-color: #000000;
            color: #00FF00; /* Cor de terminal 'legal' (verde) */
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            transition: background-color 1s ease;
        }
        
        /* =========================================================================
           SEÇÃO CSS: FASE 1: INTRODUÇÃO SUAVE (Verde)
           ========================================================================= */
        #intro-sequence {
            position: absolute;
            text-align: center;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        .intro-line {
            font-size: 0.8rem;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.5s ease;
            white-space: pre;
        }
        #main-logo {
            font-size: 3rem;
            color: #00AA00;
            text-shadow: 2px 2px 0 #000;
            opacity: 0;
            margin: 30px 0;
            transition: opacity 0.5s ease;
        }
        #press-start {
            font-size: 0.8rem;
            color: #00FF00;
            margin-top: 20px;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* =========================================================================
           SEÇÃO CSS: FASE 2: RUPTURA/CORRUPÇÃO (Vermelho)
           ========================================================================= */
        body.corrupted {
            background-color: #330000; /* Fundo Corrompido */
            cursor: none;
        }
        body.corrupted #intro-sequence {
            opacity: 0.1;
        }

        /* Efeito de Cruzes Caindo (CORREÇÃO DO ERRO DE SEGURANÇA) */
        #cross-rain-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; overflow: hidden;
            opacity: 0;
            transition: opacity 0.5s ease-in;
            z-index: 50;
        }
        body.corrupted #cross-rain-container {
            opacity: 1;
        }

        .inverted-cross {
            position: absolute;
            font-size: 3rem;
            color: #FF0000; /* Vermelho do Corvo/Sangue */
            transform: rotate(180deg);
            opacity: 0;
            /* Animação CSS pura (sem injeção dinâmica) */
            animation: fall-simple 1.5s linear forwards;
        }
        /* Animação simples de queda (para evitar o erro de cssRules) */
        @keyframes fall-simple {
            0% { transform: translate(0, 0) rotate(180deg); opacity: 0.8; }
            100% { transform: translate(0, 100vh) rotate(180deg); opacity: 0; }
        }

        /* Console de Erro */
        #console-error {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.7rem;
            color: #DC143C; /* Vermelho vivo para o erro */
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 30px;
            border: 3px solid #DC143C;
            box-shadow: 0 0 15px #DC143C;
            opacity: 0;
            transition: opacity 0.5s ease-in 0.5s; /* Aparece 0.5s após a corrupção */
            z-index: 60;
            white-space: pre;
            text-align: left;
        }
        body.corrupted #console-error {
            opacity: 1;
        }

    </style>
</head>
<body>
    <div id="intro-sequence">
        <div class="intro-line" id="line-1">V.S.A. Corp. - Boot Sequence V1.0.0</div>
        <div class="intro-line" id="line-2">Developers: Elias Thorne & Vance-Sterling Albright C.</div>
        <div id="main-logo">FLAP OF DESPAIR</div>
        <div id="press-start">PRESS ENTER OR CLICK TO START</div>
    </div>
    
    <div id="cross-rain-container"></div>
    
    <div id="console-error">
        V.S.A. Corp. Kernel Error: 666<br>
        [WARN] Failed to read resource 'THORNE_CODE.dat'<br>
        [ERROR] System Integrity Compromised.<br>
        >>> Acessando: FAILURE_LOG.exe
    </div>

    <script>
        // =====================================
        // SISTEMA DE ÁUDIO
        // =====================================
        let audioContext;
        let isCorrupted = false;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Som de Abertura (para simular a inicialização)
        function playBootSound() {
            initAudio();
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(100, audioContext.currentTime);
            osc.frequency.linearRampToValueAtTime(300, audioContext.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.2);
        }
        
        // Ruído Branco (para a falha crítica)
        function playWhiteNoise(duration = 2.5) {
            initAudio();
            const bufferSize = audioContext.sampleRate * duration;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const source = audioContext.createBufferSource();
            const gainNode = audioContext.createGain();
            source.buffer = buffer;
            source.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            source.start(audioContext.currentTime);
            source.stop(audioContext.currentTime + duration);
        }

        // =====================================
        // INTRODUÇÃO SUAVE (Fase 1)
        // =====================================
        function runIntroSequence() {
            const lines = ['line-1', 'line-2', 'main-logo'];
            let delay = 300; // MS de atraso entre as linhas

            lines.forEach((id, index) => {
                const element = document.getElementById(id);
                if (element) {
                    setTimeout(() => {
                        element.style.opacity = '1';
                        playBootSound();
                    }, delay * (index + 1));
                }
            });
        }
        
        // =====================================
        // CORRUPÇÃO E QUEDA DE CRUZES (Fase 2)
        // =====================================
        function startCrossRain() {
            const container = document.getElementById('cross-rain-container');
            
            for (let i = 0; i < 50; i++) { // 50 cruzes caindo
                const cross = document.createElement('div');
                cross.className = 'inverted-cross';
                cross.textContent = '✝';
                
                // Posição e atraso aleatórios (usando apenas CSS para a animação)
                const startX = Math.random() * window.innerWidth;
                const delay = Math.random() * 0.5; // Atraso de 0 a 0.5s

                cross.style.left = `${startX}px`;
                cross.style.top = '-50px';
                cross.style.animationDelay = `${delay}s`; // Controla o atraso da animação CSS
                
                container.appendChild(cross);
            }
        }

        function startGame() {
            if (isCorrupted) return;
            isCorrupted = true;
            
            // 1. Inicia o Ruído e Altera o Fundo (Ruptura)
            playWhiteNoise(2.5);
            document.body.classList.add('corrupted');
            
            // 2. Inicia a chuva de cruzes invertidas e o console
            startCrossRain();
            
            // 3. Transição para a próxima tela
            setTimeout(() => {
                // Redireciona para a tela inicial do jogo
                window.location.href = 'selecao.html'; 
            }, 2500); // 2.5 segundos de ruído e corrupção
        }

        // =====================================
        // EVENT LISTENERS
        // =====================================
        
        // Inicia a sequência de introdução suave
        window.addEventListener('load', runIntroSequence);

        // Interação para iniciar a corrupção (depois da intro)
        document.body.addEventListener('click', startGame);
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                startGame();
            }
        });
        
    </script>
    <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/Flap-of-Despair/service-worker.js')
          .then(registration => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch(error => {
            console.log('Falha ao registrar Service Worker:', error);
          });
      });
    }
</script>


</body>
</html>
