<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAME OVER - O Abismo</title>
    <script src="gameover_handler.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* =========================================================================
           ESTILOS GERAIS: O VAZIO E O SIL√äNCIO
           ========================================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        body {
            background-color: #000; /* Fundo Totalmente PRETO */
            color: #FF0000; /* Texto Vermelho (erro/fatal) */
            font-family: 'Press Start 2P', monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Foco no centro da tela para o texto */
        #text-container {
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
            margin-bottom: 50px;
            min-height: 200px; /* Garante que o container permane√ßa centralizado */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .text-line {
            display: block;
            margin: 10px 0;
            opacity: 0; /* Come√ßa invis√≠vel */
            white-space: pre-wrap;
            overflow: hidden;
        }

        /* EFEITO DE FOGO SUTIL NOS PERSONAGENS (INFERIOR DA TELA) */
        #characters-base {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding: 20px 0;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.5)); /* Sombra para simular o brilho do fogo */
        }

        .char-icon {
            font-size: 3rem;
            margin: 0 20px;
            transform: rotate(180deg); /* √çcones de cabe√ßa para baixo (ca√≠dos) */
            animation: burn 2s ease-in-out infinite alternate; /* Efeito de c√≥digo sendo queimado */
            opacity: 0.5;
        }

        /* Anima√ß√£o de Fogo/Consumo (sutil) */
        @keyframes burn {
            0% { transform: rotate(180deg) scale(1); filter: drop-shadow(0 0 5px #ff6a00); } /* Laranja */
            100% { transform: rotate(180deg) scale(0.95); filter: drop-shadow(0 0 10px #00FF00); } /* Verde Neon/Cinza */
        }
        .char-icon:nth-child(2) { animation-delay: 0.5s; }
        .char-icon:nth-child(3) { animation-delay: 1s; }


        /* =========================================================================
           BOT√ÉO DE A√á√ÉO
           ========================================================================= */
        #action-button {
            padding: 15px 30px;
            background: #8B0000; /* Vermelho Escuro */
            border: 2px solid #DC143C; /* Borda Carmesim */
            color: #f7f3e8;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px #8B0000;
            margin-top: 20px;
            display: none; /* Inicia oculto */
        }
        #action-button:hover {
            background: #DC143C;
            box-shadow: 0 0 15px #DC143C;
            transform: scale(1.05);
        }
        
        /* Zumbido de fundo (apenas para efeito conceitual, sem √°udio real no CSS) */
        /* body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(0, 0, 0, 0) 50%, rgba(10, 10, 10, 0.1) 100%);
            animation: buzz 5s infinite alternate;
            pointer-events: none;
        }
        @keyframes buzz {
            0% { opacity: 0.5; }
            100% { opacity: 0.4; }
        } */
    </style>
</head>
<body>

    <div id="text-container">
        </div>

    <button id="action-button">VOLTE PARA O IN√çCIO</button>

    <div id="characters-base">
        <span class="char-icon">ü¶ê</span>
        <span class="char-icon">üê¢</span>
        <span class="char-icon">üêù</span>
    </div>

        <script>
        // =====================================
        // CONFIGURA√á√ÉO DO FLUXO DE TEXTO
        // =====================================

        const ABYSS_MESSAGE = [
            { text: "Bem-vindo, campe√£o. Voc√™ est√° com dificuldade no n√≠vel atual?", pause: 2000 },
            { text: "O problema n√£o √© o software. O Lastro n√£o est√° na f√≠sica; ele est√° na sua m√£o. Seu toque falha. Seu ritmo √© inst√°vel. Voc√™ √© quem n√£o consegue sustentar o ritmo.", pause: 4000 },
            { text: "Voc√™ n√£o pode recuar para a superf√≠cie. Voc√™ perdeu o direito ao SIL√äNCIO na sua cabe√ßa. O jogo n√£o aceita a sua falha. O Predador te espera.", pause: 0 } 
        ];

        const TYPING_DELAY = 50; // Velocidade de digita√ß√£o (ms por caractere)
        const textContainer = document.getElementById('text-container');
        const actionButton = document.getElementById('action-button');
        let currentLineIndex = 0;

        // =====================================
        // L√ìGICA DE √ÅUDIO E EFEITOS (Simula√ß√£o de Bipe)
        // =====================================
        let audioContext;
        function initAudio() {
            if (!audioContext) { 
                audioContext = new (window.AudioContext || window.webkitAudioContext)(); 
            }
        }
        
        function playBipSound(frequency, duration) { 
            initAudio(); 
            if (audioContext.state === 'suspended') { audioContext.resume(); } 
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain); 
            gain.connect(audioContext.destination);
            
            osc.type = 'square';
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gain.gain.setValueAtTime(0.05, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration / 1000);
            
            osc.start(audioContext.currentTime); 
            osc.stop(audioContext.currentTime + duration / 1000);
        }

        // Fun√ß√£o principal para transmitir o texto com efeito de digita√ß√£o
        function transmitText() {
            if (currentLineIndex >= ABYSS_MESSAGE.length) {
                // Fim da transmiss√£o
                playBipSound(100, 500); // Bipe final
                setTimeout(() => {
                    actionButton.style.display = 'block';
                    // Altera o texto do bot√£o para refor√ßar o tema
                    actionButton.textContent = "VOLTE PARA O ABISMO";
                }, 1000); // Aparece 1 segundo ap√≥s a √∫ltima frase
                return;
            }

            const currentMessage = ABYSS_MESSAGE[currentLineIndex];
            const lineElement = document.createElement('span');
            lineElement.className = 'text-line';
            textContainer.appendChild(lineElement);
            
            let charIndex = 0;
            
            function typeChar() {
                if (charIndex < currentMessage.text.length) {
                    const char = currentMessage.text.charAt(charIndex);
                    lineElement.textContent += char;
                    lineElement.style.opacity = 1;
                    playBipSound(800 + Math.random() * 200, 10); // Som de digita√ß√£o
                    charIndex++;
                    setTimeout(typeChar, TYPING_DELAY);
                } else {
                    // Linha completa, espera o tempo de pausa
                    setTimeout(() => {
                        currentLineIndex++;
                        transmitText(); // Chama a pr√≥xima linha
                    }, currentMessage.pause);
                }
            }

            typeChar();
        }


        // =====================================
        // L√ìGICA DO BOT√ÉO E REDIRECIONAMENTO (CORRIGIDA)
        // =====================================

        actionButton.addEventListener('click', function() {
            playBipSound(350, 50); // Som de clique
            
            // 1. Tentar obter a URL de retorno salva pelo jogo
            const returnPage = localStorage.getItem('gameover_return_page');
            
            if (returnPage) {
                // 2. Se a URL foi salva, volta para ela.
                window.location.href = returnPage;
            } else if (document.referrer) {
                // 3. Fallback: Se n√£o houver dado salvo, usa o referrer (menos confi√°vel).
                window.location.href = document.referrer;
            } else {
                // 4. √öltimo Fallback: Volta para a p√°gina de sele√ß√£o/in√≠cio
                console.warn("P√°gina de retorno n√£o encontrada. Redirecionando para 'selecao.html'.");
                window.location.href = 'selecao.html'; 
            }
        });

        // Iniciar a transmiss√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', transmitText);
    </script>

</body>
</html>
